<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Carregando post...</title>
  <link rel="stylesheet" href="css/main.css">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "7839603b0b7341f6be8508063bbb734a"}'></script><!-- End Cloudflare Web Analytics -->
</head>
<body>
  <header>
    <h1>Blog do Patrick</h1>
    
    <!-- Bot√£o de tema -->
    <div class="theme-switch-wrapper">
      <label class="theme-switch">
        <input type="checkbox" id="theme-toggle">
        <span class="slider round"></span>
      </label>
      <span class="theme-label">Neon Dark</span>
    </div>
    <button class="back-link-post" onclick="history.back()">‚Üê Voltar para a lista de posts</button>
  </header>

  <main id="post-container">
    <p>Carregando post...</p>
  </main>

  <footer>
    <p>Feito com <svg class="heart-svg" width="1em" height="1em" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg> e JSON | <a href="https://webpatrickworks.github.io/blog-patrick">C√≥digo-fonte</a></p>
  </footer>

  <script>
    // Theme switcher (copiado/adaptado do main.js)
    document.addEventListener('DOMContentLoaded', () => {
      const toggle = document.getElementById('theme-toggle');
      const label = document.querySelector('.theme-label');
      
      if (!toggle || !label) return; // seguran√ßa caso n√£o encontre os elementos

      // Carrega tema salvo (ou usa neon como default)
      const currentTheme = localStorage.getItem('theme') || 'neon';
      document.documentElement.setAttribute('data-theme', currentTheme);
      
      if (currentTheme === 'modern') {
        toggle.checked = true;
        label.textContent = 'Modern Tech';
      } else if (currentTheme === 'light') {
        toggle.checked = true;
        label.textContent = 'Light Mode';
      } else {
        toggle.checked = false;
        label.textContent = 'Neon Dark';
      }

      toggle.addEventListener('change', () => {
        let theme;
        if (toggle.checked) {
          // Alterna: modern ‚Üí light ‚Üí neon (ou s√≥ modern ‚Üî neon se preferir)
          if (document.documentElement.getAttribute('data-theme') === 'modern') {
            theme = 'light';
            label.textContent = 'Light Mode';
          } else {
            theme = 'modern';
            label.textContent = 'Modern Tech';
          }
        } else {
          theme = 'neon';
          label.textContent = 'Neon Dark';
        }
        
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
      });
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const container = document.getElementById('post-container');
      const urlParams = new URLSearchParams(window.location.search);
      const postId = urlParams.get('id');

      if (!postId) {
        container.innerHTML = '<p>Post n√£o encontrado.</p>';
        return;
      }

      fetch('data/posts.json')
        .then(response => response.json())
        .then(posts => {
          const post = posts.find(p => p.id == postId);
          console.log('Post encontrado:', post);
          if (!post) {
            container.innerHTML = '<p>Post n√£o encontrado.</p>';
            return;
          }
          
          container.innerHTML = '';
          document.title = post.title + ' | Blog do Patrick';

          // PRIMEIRO: limpa o content (n√£o depende de data)
          let cleanContent = post.content.replace(/^<h1>.*?<\/h1>\s*/i, '').trim();
          console.log('cleanContent length:', cleanContent.length);
          console.log('cleanContent starts with:', cleanContent.substring(0, 200));

          // SEGUNDO: calcula data e disclaimer (agora post existe)
          let disclaimerHTML = '';
          const postDateObj = new Date(post.date);

          if (isNaN(postDateObj.getTime())) {
            console.warn('Data inv√°lida no post:', post.date);
            disclaimerHTML = '<div class="outdated-banner">Data de publica√ß√£o inv√°lida.</div>';
          } else {
            const now = new Date();
            const daysOld = Math.floor((now - postDateObj) / (1000 * 60 * 60 * 24));
            const isOutdated = daysOld >= 7;  // ou FRESH_DAYS se voc√™ definir como const global

            if (isOutdated) {
              const formattedDate = postDateObj.toLocaleDateString('pt-BR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              });

              disclaimerHTML = `
                <div class="outdated-banner">
                  <strong>Aviso importante:</strong><br>
                  Esta not√≠cia foi publicada em ${formattedDate} (${daysOld} dias atr√°s) e <strong>pode estar desatualizada</strong>.<br>
                  Verifique as fontes originais (linkadas no artigo) ou busque not√≠cias recentes para o status atual.<br>
                  O Blog do Patrick n√£o se responsabiliza por decis√µes baseadas em informa√ß√µes obsoletas.
                </div>
              `;
            }
          }

          // TERCEIRO: cria postDate para o <time> (vers√£o sem timezone issues)
          const [year, month, day] = post.date.split('-');
          const postDate = new Date(Number(year), Number(month) - 1, Number(day));
          console.log('postDate criado:', postDate.toISOString());

          // Monte o DOM
          const article = document.createElement('article');
          article.className = 'post-content';

          // Header
          const header = document.createElement('div');
          header.className = 'post-header';
          header.innerHTML = `
            <h1>${post.title}</h1>
            <time datetime="${post.date}">
              ${postDate.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
            <button id="share-btn" class="share-btn">üîó Compartilhar</button>
          `;
          article.appendChild(header);

          // Disclaimer
          if (disclaimerHTML) {
            const bannerDiv = document.createElement('div');
            bannerDiv.innerHTML = disclaimerHTML;
            article.appendChild(bannerDiv.firstElementChild || bannerDiv);  // mais seguro
          }

          // Content
          const contentDiv = document.createElement('div');
          contentDiv.className = 'content';
          contentDiv.innerHTML = cleanContent;
          article.appendChild(contentDiv);

          container.appendChild(article);

          // Bot√£o voltar
          const backBtn = document.createElement('button');
          backBtn.className = 'back-link-post';
          backBtn.textContent = '‚Üê Voltar para a lista de posts';
          backBtn.onclick = () => history.back();
          container.appendChild(backBtn);

          // Share
          const shareBtn = document.getElementById('share-btn');
          shareBtn.addEventListener('click', () => {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
              const original = shareBtn.innerHTML;
              shareBtn.innerHTML = '‚úÖ Link copiado!';
              shareBtn.style.background = 'var(--neon-green)';
              shareBtn.style.color = '#000';
              setTimeout(() => {
                shareBtn.innerHTML = original;
                shareBtn.style.background = '';
                shareBtn.style.color = '';
              }, 2200);
            }).catch(() => {
              alert('Erro ao copiar o link. Tente novamente.');
            });
          });

          console.log('Montagem do DOM conclu√≠da sem erro');
        })
        .catch(error => {
          console.error('Catch acionado com erro:', error);
          container.innerHTML = '<p>Erro ao carregar o post: ' + (error.message || 'desconhecido') + '</p>';
        });
    });
  </script>

</body>
</html>