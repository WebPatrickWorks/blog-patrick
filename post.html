<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Carregando post...</title>
  <link rel="stylesheet" href="css/main.css">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "7839603b0b7341f6be8508063bbb734a"}'></script><!-- End Cloudflare Web Analytics -->
</head>
<body>
  <header>
    <h1>Blog do Patrick</h1>
    
    <!-- Botão de tema -->
    <div class="theme-switch-wrapper">
      <label class="theme-switch">
        <input type="checkbox" id="theme-toggle">
        <span class="slider round"></span>
      </label>
      <span class="theme-label">Neon Dark</span>
    </div>

    <a href="index.html" class="back-link">← Voltar para a lista de posts</a>
  </header>

  <main id="post-container">
    <p>Carregando post...</p>
  </main>

  <footer>
    <p>Feito com ❤️ e JSON | <a href="https://webpatrickworks.github.io/blog-patrick">Código-fonte</a></p>
  </footer>

  <script>
    // Theme switcher (copiado/adaptado do main.js)
    document.addEventListener('DOMContentLoaded', () => {
      const toggle = document.getElementById('theme-toggle');
      const label = document.querySelector('.theme-label');
      
      if (!toggle || !label) return; // segurança caso não encontre os elementos

      // Carrega tema salvo (ou usa neon como default)
      const currentTheme = localStorage.getItem('theme') || 'neon';
      document.documentElement.setAttribute('data-theme', currentTheme);
      
      if (currentTheme === 'modern') {
        toggle.checked = true;
        label.textContent = 'Modern Tech';
      } else if (currentTheme === 'light') {
        toggle.checked = true;
        label.textContent = 'Light Mode';
      } else {
        toggle.checked = false;
        label.textContent = 'Neon Dark';
      }

      toggle.addEventListener('change', () => {
        let theme;
        if (toggle.checked) {
          // Alterna: modern → light → neon (ou só modern ↔ neon se preferir)
          if (document.documentElement.getAttribute('data-theme') === 'modern') {
            theme = 'light';
            label.textContent = 'Light Mode';
          } else {
            theme = 'modern';
            label.textContent = 'Modern Tech';
          }
        } else {
          theme = 'neon';
          label.textContent = 'Neon Dark';
        }
        
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
      });
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('post-container');
    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('id');

    if (!postId) {
      container.innerHTML = '<p>Post não encontrado. Volte para a <a href="index.html">página inicial</a>.</p>';
      document.title = 'Post não encontrado';
      return;
    }

    fetch('data/posts.json')
      .then(response => {
        if (!response.ok) throw new Error('Erro ao carregar os posts');
        return response.json();
      })
      .then(posts => {
        const post = posts.find(p => p.id == postId); // == para comparar string/number

        if (!post) {
          container.innerHTML = '<p>Post não encontrado. Volte para a <a href="index.html">página inicial</a>.</p>';
          document.title = 'Post não encontrado';
          return;
        }

        // Atualiza título da página
        document.title = post.title + ' | Blog do Patrick';

        // Insere o HTML base, mas esconde o conteúdo inicialmente
        container.innerHTML = `
          <article class="post-content">
            <h2>${post.title}</h2>
            <time datetime="${post.date}">${new Date(post.date).toLocaleDateString('pt-BR', {
              weekday: 'long',
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })}</time>
            <div class="tags">
              ${post.tags.map(tag => `<span>#${tag}</span>`).join(' ')}
            </div>
            <div class="content content-typing" id="typing-content"></div> <!-- Aqui vai o texto digitado -->
          </article>
          <a href="index.html" class="back-link">← Voltar para a lista de posts</a>
        `;

        // Agora aplica o efeito de digitação
        typeWriter(post.content, document.getElementById('typing-content'));
      })
      .catch(error => {
        console.error(error);
        container.innerHTML = '<p>Ops... não consegui carregar o post. Verifique o console ou tente novamente.</p>';
      });
  });

  // Função para simular digitação
  function typeWriter(fullHtml, targetElement) {
    let i = 0;
    const speed = 0.5; // Velocidade em ms por caractere (ajuste para mais rápido/lento)

    // Como o conteúdo é HTML, vamos "digitar" o texto puro, mas preservar as tags
    // Para simplicidade, vamos tratar como texto e inserir como innerHTML no final de cada passo
    function type() {
      if (i < fullHtml.length) {
        targetElement.innerHTML = fullHtml.substring(0, i + 1); // Insere progressivamente
        i++;
        setTimeout(type, speed);
      } else {
        // Remove o cursor piscando ao finalizar
        targetElement.classList.remove('content-typing');
      }
    }
    type();
  }
  </script>
</body>
</html>